<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SavePlan Pro - Smart Financial Calculator</title>

        <!-- External Fonts -->
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- External Libraries -->
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Custom Styles -->
        <link rel="stylesheet" href="css/styles.css" />
    </head>
    <body>
        <div class="app-container">
            <!-- Header Section -->
            <header class="app-header">
                <div class="header-content">
                    <h1 class="app-title">
                        <svg
                            width="32"
                            height="32"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <circle cx="12" cy="12" r="10" />
                            <path d="M12 6v6l4 2" />
                        </svg>
                        SavePlan Pro
                    </h1>
                    <p class="app-subtitle">
                        Plan your financial future in 3 simple steps
                    </p>

                    <!-- Action Buttons -->
                    <div class="header-actions">
                        <button
                            class="btn btn-outline"
                            onclick="resetCalculator()"
                        >
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
                                />
                                <path d="M21 3v5h-5" />
                                <path
                                    d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"
                                />
                                <path d="M8 16H3v5" />
                            </svg>
                            Reset
                        </button>
                        <button
                            class="btn btn-primary"
                            onclick="shareResults()"
                        >
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"
                                />
                                <polyline points="16,6 12,2 8,6" />
                                <line x1="12" x2="12" y1="2" y2="15" />
                            </svg>
                            Share Plan
                        </button>
                    </div>
                </div>
            </header>

            <!-- Step Progress -->
            <div class="step-progress">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Your Goal</div>
                </div>
                <div class="step active" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Your Income</div>
                </div>
                <div class="step active" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Your Plan</div>
                </div>
            </div>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Step 1: Financial Goal -->
                <section class="step-section" id="step1">
                    <div class="step-header">
                        <h2>
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M9 12l2 2 4-4" />
                                <path
                                    d="M21 12c.552 0 1.447-.715 1.447-1.5S21.552 9 21 9s-1.447.715-1.447 1.5S20.448 12 21 12z"
                                />
                                <path
                                    d="M11.5 7H6a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h5.5"
                                />
                                <path d="M21 12H10" />
                            </svg>
                            Step 1: What's Your Financial Goal?
                        </h2>
                        <p class="step-description">
                            Tell us about your savings goal and timeline
                        </p>
                    </div>

                    <!-- Currency Selector -->
                    <div class="currency-selector">
                        <label for="currency">
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="12" cy="12" r="10" />
                                <path d="M12 6v6l4 2" />
                            </svg>
                            Currency:
                        </label>
                        <select
                            id="currency"
                            onchange="handleCurrencyChange(this.value)"
                        >
                            <option value="EUR" selected>EUR (€)</option>
                            <option value="SEK">SEK (kr)</option>
                            <option value="USD">USD ($)</option>
                            <option value="GBP">GBP (£)</option>
                            <option value="NOK">NOK (kr)</option>
                            <option value="DKK">DKK (kr)</option>
                        </select>
                    </div>

                    <div class="form-grid">
                        <div class="input-card">
                            <label for="goal" class="input-label">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path d="M12 2v20" />
                                    <path
                                        d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                                    />
                                </svg>
                                How much do you want to save?
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="number"
                                    id="goal"
                                    value="1000000"
                                    class="form-input large-input"
                                    placeholder="1000000"
                                />
                                <span class="input-suffix">EUR</span>
                            </div>
                            <div class="input-help">
                                Examples: House down payment, emergency fund,
                                vacation
                            </div>
                        </div>

                        <div class="input-card">
                            <label for="current" class="input-label">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <rect
                                        width="20"
                                        height="14"
                                        x="2"
                                        y="5"
                                        rx="2"
                                    />
                                    <line x1="2" x2="22" y1="10" y2="10" />
                                </svg>
                                How much have you saved already?
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="number"
                                    id="current"
                                    value="0"
                                    class="form-input"
                                    placeholder="0"
                                />
                                <span class="input-suffix">EUR</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div
                                        class="progress-fill"
                                        id="progressFill"
                                    ></div>
                                </div>
                                <div class="progress-text" id="progressText">
                                    20% of your goal
                                </div>
                            </div>
                        </div>

                        <div class="input-card">
                            <label for="timeframe" class="input-label">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <circle cx="12" cy="12" r="10" />
                                    <polyline points="12,6 12,12 16,14" />
                                </svg>
                                When do you want to reach this goal?
                            </label>

                            <!-- Timeframe Unit Toggle -->
                            <div class="timeframe-toggle">
                                <button
                                    type="button"
                                    class="timeframe-btn"
                                    data-unit="months"
                                    onclick="switchTimeframeUnit('months')"
                                >
                                    Months
                                </button>
                                <button
                                    type="button"
                                    class="timeframe-btn active"
                                    data-unit="years"
                                    onclick="switchTimeframeUnit('years')"
                                >
                                    Years
                                </button>
                            </div>

                            <div class="input-wrapper">
                                <input
                                    type="number"
                                    id="timeframe"
                                    value="30"
                                    step="0.5"
                                    class="form-input"
                                    placeholder="30"
                                    onchange="handleTimeframeChange()"
                                />
                                <span class="input-suffix" id="timeframeSuffix"
                                    >years</span
                                >
                            </div>
                            <div class="input-help">
                                <span id="timeframeDisplay"
                                    >That's 30 years</span
                                >
                            </div>
                        </div>

                        <div class="input-card">
                            <!-- Investing Toggle -->
                            <div class="toggle-section">
                                <label class="toggle-label">
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polyline
                                            points="22,12 18,12 15,21 9,3 6,12 2,12"
                                        />
                                    </svg>
                                    Are you investing your monthly savings?
                                </label>
                                <div class="toggle-container">
                                    <input
                                        type="checkbox"
                                        id="investingToggle"
                                        class="toggle-input"
                                        checked
                                        onchange="handleInvestingToggle(this.checked)"
                                    />
                                    <label
                                        for="investingToggle"
                                        class="toggle-switch"
                                    >
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-text" id="investingText"
                                        >Yes</span
                                    >
                                </div>
                            </div>
                        </div>

                        <!-- ROI Field (shown when investing) -->
                        <div class="input-card" id="roiSection">
                            <label for="roi" class="input-label">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <polyline
                                        points="22,12 18,12 15,21 9,3 6,12 2,12"
                                    />
                                </svg>
                                Expected yearly return on investments
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="number"
                                    id="roi"
                                    value="5"
                                    step="0.1"
                                    class="form-input"
                                    placeholder="5"
                                />
                                <span class="input-suffix">%</span>
                            </div>
                            <div class="input-help">
                                Conservative: 3-4%, Balanced: 5-7%, Aggressive:
                                8%+
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Step 2: Income -->
                <section class="step-section" id="step2">
                    <div class="step-header">
                        <h2>
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"
                                />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                            Step 2: Tell Us About Your Income
                        </h2>
                        <p class="step-description">
                            Add all sources of monthly income in your household
                        </p>
                    </div>

                    <div class="income-section">
                        <div class="toggle-card">
                            <div class="toggle-header">
                                <div class="toggle-info">
                                    <h3>Multiple Income Earners</h3>
                                    <p>
                                        Are you planning this together with
                                        someone?
                                    </p>
                                </div>
                                <div
                                    class="toggle-switch"
                                    id="multipleEarnersToggle"
                                    onclick="toggleMultipleEarners()"
                                ></div>
                            </div>
                        </div>

                        <div class="income-earners" id="incomeEarners">
                            <div class="income-card" data-earner="0">
                                <div class="income-header">
                                    <div class="earner-info">
                                        <svg
                                            width="20"
                                            height="20"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                        >
                                            <path
                                                d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                                            />
                                            <circle cx="12" cy="7" r="4" />
                                        </svg>
                                        <span class="earner-title"
                                            >Your Monthly Income (after
                                            tax)</span
                                        >
                                    </div>
                                </div>
                                <div class="input-wrapper">
                                    <input
                                        type="number"
                                        class="income-input form-input large-input"
                                        value="3000"
                                        data-earner="0"
                                        placeholder="3000"
                                    />
                                    <span class="input-suffix">EUR</span>
                                </div>
                            </div>
                        </div>

                        <button
                            class="add-income-btn"
                            id="addEarnerBtn"
                            onclick="addIncomeEarner()"
                            style="display: none"
                        >
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M5 12h14" />
                                <path d="M12 5v14" />
                            </svg>
                            Add Another Person's Income
                        </button>

                        <div class="input-card">
                            <label for="expenses" class="input-label">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <circle cx="8" cy="21" r="1" />
                                    <circle cx="19" cy="21" r="1" />
                                    <path
                                        d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57L22 6H7"
                                    />
                                </svg>
                                Monthly expenses (rent, food, bills, etc.)
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="number"
                                    id="expenses"
                                    value="2000"
                                    class="form-input"
                                    placeholder="2000"
                                />
                                <span class="input-suffix">EUR</span>
                            </div>
                            <div class="input-help">
                                Include rent, food, utilities, insurance, etc.
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Step 3: Results -->
                <section class="step-section" id="step3">
                    <div class="step-header">
                        <h2>
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <polyline
                                    points="22,12 18,12 15,21 9,3 6,12 2,12"
                                />
                            </svg>
                            Step 3: Your Personalized Plan
                        </h2>
                        <p class="step-description">
                            Here's what you need to do to reach your goal
                        </p>
                    </div>

                    <!-- Key Result -->
                    <div class="hero-result">
                        <div class="hero-content">
                            <div class="hero-label">You need to save</div>
                            <div class="hero-amount" id="heroAmount">
                                1,000 EUR
                            </div>
                            <div class="hero-description">
                                every month to reach your goal
                            </div>
                            <div class="hero-status" id="heroStatus">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path d="M9 12l2 2 4-4" />
                                    <circle cx="12" cy="12" r="10" />
                                </svg>
                                This looks achievable!
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Results -->
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-icon">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"
                                    />
                                    <circle cx="9" cy="7" r="4" />
                                    <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                </svg>
                            </div>
                            <div class="result-content">
                                <div class="result-label">
                                    Total Household Income
                                </div>
                                <div class="result-value" id="householdIncome">
                                    3,000 EUR
                                </div>
                            </div>
                        </div>

                        <div class="result-card">
                            <div class="result-icon">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <line x1="12" x2="12" y1="1" y2="23" />
                                    <path
                                        d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                                    />
                                </svg>
                            </div>
                            <div class="result-content">
                                <div class="result-label">
                                    Left After Expenses & Saving
                                </div>
                                <div class="result-value" id="availableIncome">
                                    0 EUR
                                </div>
                            </div>
                        </div>

                        <div class="result-card">
                            <div class="result-icon">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                                    <line x1="9" x2="9.01" y1="9" y2="9" />
                                    <line x1="15" x2="15.01" y1="9" y2="9" />
                                </svg>
                            </div>
                            <div class="result-content">
                                <div class="result-label">Savings Rate</div>
                                <div class="result-value" id="savingsRate">
                                    32%
                                </div>
                            </div>
                        </div>

                        <div class="result-card highlight">
                            <div class="result-icon">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <polyline
                                        points="22,12 18,12 15,21 9,3 6,12 2,12"
                                    />
                                </svg>
                            </div>
                            <div class="result-content">
                                <div class="result-label">
                                    Final Amount (with growth)
                                </div>
                                <div
                                    class="result-value large"
                                    id="futureValue"
                                >
                                    4,321,942 EUR
                                </div>
                            </div>
                        </div>

                        <div class="result-card">
                            <div class="result-icon">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <rect
                                        width="20"
                                        height="14"
                                        x="2"
                                        y="5"
                                        rx="2"
                                    />
                                    <line x1="2" x2="22" y1="10" y2="10" />
                                </svg>
                            </div>
                            <div class="result-content">
                                <div class="result-label">
                                    Total You'll Save
                                </div>
                                <div
                                    class="result-value"
                                    id="totalContributions"
                                >
                                    360,000 EUR
                                </div>
                            </div>
                        </div>

                        <div class="result-card success">
                            <div class="result-icon">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <polyline
                                        points="22,12 18,12 15,21 9,3 6,12 2,12"
                                    />
                                </svg>
                            </div>
                            <div class="result-content">
                                <div class="result-label">
                                    Interest You'll Earn
                                </div>
                                <div class="result-value" id="interestEarned">
                                    3,961,942 EUR
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Chart Section -->
                <section class="chart-section">
                    <div class="section-header">
                        <h3>See Your Money Grow Over Time</h3>
                        <p>
                            This chart shows how your savings will grow month by
                            month
                        </p>
                    </div>
                    <div class="chart-container">
                        <canvas id="savingsChart"></canvas>
                    </div>
                </section>

                <!-- Tips Section -->
                <section class="tips-section">
                    <div class="section-header">
                        <h3>
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="12" cy="12" r="10" />
                                <path d="m9 12 2 2 4-4" />
                            </svg>
                            Smart Tips for Your Plan
                        </h3>
                        <p>Personalized advice to help you succeed</p>
                    </div>
                    <div class="tips-grid" id="tipsContainer">
                        <!-- Tips will be populated by JavaScript -->
                    </div>
                </section>
            </main>

            <!-- Share Modal -->
            <div class="modal" id="shareModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Share Your Financial Plan</h3>
                        <button class="modal-close" onclick="closeShareModal()">
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="share-options">
                            <button
                                class="share-btn chatgpt"
                                onclick="shareToAI('chatgpt')"
                            >
                                <div class="share-icon">
                                    <img
                                        src="https://unpkg.com/@lobehub/icons-static-svg@latest/icons/openai.svg"
                                        alt="OpenAI"
                                        width="24"
                                        height="24"
                                    />
                                </div>
                                <div class="share-info">
                                    <div class="share-title">
                                        Share with ChatGPT
                                    </div>
                                    <div class="share-desc">
                                        Get AI advice on your plan
                                    </div>
                                </div>
                            </button>

                            <button
                                class="share-btn claude"
                                onclick="shareToAI('claude')"
                            >
                                <div class="share-icon">
                                    <img
                                        src="https://unpkg.com/@lobehub/icons-static-svg@latest/icons/anthropic.svg"
                                        alt="Anthropic"
                                        width="24"
                                        height="24"
                                    />
                                </div>
                                <div class="share-info">
                                    <div class="share-title">
                                        Share with Claude
                                    </div>
                                    <div class="share-desc">
                                        Get detailed financial analysis
                                    </div>
                                </div>
                            </button>

                            <button
                                class="share-btn mistral"
                                onclick="shareToAI('mistral')"
                            >
                                <div class="share-icon">
                                    <img
                                        src="https://unpkg.com/@lobehub/icons-static-svg@latest/icons/mistral.svg"
                                        alt="Mistral"
                                        width="24"
                                        height="24"
                                    />
                                </div>
                                <div class="share-info">
                                    <div class="share-title">
                                        Share with Mistral
                                    </div>
                                    <div class="share-desc">
                                        Quick financial insights
                                    </div>
                                </div>
                            </button>

                            <button
                                class="share-btn copy"
                                onclick="copyReport()"
                            >
                                <div class="share-icon">📋</div>
                                <div class="share-info">
                                    <div class="share-title">
                                        Copy to Clipboard
                                    </div>
                                    <div class="share-desc">
                                        Paste anywhere you like
                                    </div>
                                </div>
                            </button>

                            <button
                                class="share-btn email"
                                onclick="shareByEmail()"
                            >
                                <div class="share-icon">📧</div>
                                <div class="share-info">
                                    <div class="share-title">Email Report</div>
                                    <div class="share-desc">
                                        Send to yourself or others
                                    </div>
                                </div>
                            </button>
                        </div>

                        <div class="report-preview">
                            <h4>Report Preview:</h4>
                            <div class="report-content" id="reportPreview">
                                <!-- Report content will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Success Message -->
            <div class="toast" id="successToast">
                <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <path d="M9 12l2 2 4-4" />
                    <circle cx="12" cy="12" r="10" />
                </svg>
                <span id="toastMessage">Success!</span>
            </div>
        </div>

        <!-- JavaScript Files -->
        <script src="js/utils.js"></script>
        <script src="js/income.js"></script>
        <script src="js/chart.js"></script>
        <script src="js/tips.js"></script>
        <script src="js/sharing.js"></script>
        <script src="js/main.js"></script>

        <script>
            // Global timeframe state
            let currentTimeframeUnit = "years";

            // Quick inline functions for immediate UI feedback
            function updateTimeframeDisplay() {
                const timeframeValue =
                    parseFloat(document.getElementById("timeframe").value) ||
                    36;
                let displayText = "";

                if (currentTimeframeUnit === "months") {
                    const years = Math.round((timeframeValue / 12) * 10) / 10;
                    if (timeframeValue === 1) {
                        displayText = "That's 1 month";
                    } else if (years === 1) {
                        displayText = "That's 1 year";
                    } else if (years < 1) {
                        displayText = `That's ${timeframeValue} months`;
                    } else {
                        displayText =
                            years % 1 === 0
                                ? `That's ${Math.round(years)} years`
                                : `That's ${years} years`;
                    }
                } else {
                    const months = Math.round(timeframeValue * 12);
                    if (timeframeValue === 1) {
                        displayText = "That's 12 months";
                    } else if (timeframeValue === 0.5) {
                        displayText = "That's 6 months";
                    } else {
                        displayText = `That's ${months} months`;
                    }
                }

                document.getElementById("timeframeDisplay").textContent =
                    displayText;
            }

            function switchTimeframeUnit(unit) {
                const timeframeInput = document.getElementById("timeframe");
                const timeframeSuffix =
                    document.getElementById("timeframeSuffix");
                const currentValue = parseFloat(timeframeInput.value) || 36;

                // Remove active class from all buttons
                document.querySelectorAll(".timeframe-btn").forEach((btn) => {
                    btn.classList.remove("active");
                });

                // Add active class to clicked button
                document
                    .querySelector(`[data-unit="${unit}"]`)
                    .classList.add("active");

                // Convert value if switching units
                if (currentTimeframeUnit !== unit) {
                    let newValue;
                    if (unit === "years" && currentTimeframeUnit === "months") {
                        // Converting months to years
                        newValue = Math.round((currentValue / 12) * 10) / 10;
                        if (newValue < 0.5) newValue = 0.5; // Minimum 6 months
                    } else if (
                        unit === "months" &&
                        currentTimeframeUnit === "years"
                    ) {
                        // Converting years to months
                        newValue = Math.round(currentValue * 12);
                        if (newValue < 1) newValue = 1; // Minimum 1 month
                    } else {
                        newValue = currentValue;
                    }

                    timeframeInput.value = newValue;
                    timeframeInput.step = unit === "years" ? "0.5" : "1";
                    timeframeInput.min = unit === "years" ? "0.5" : "1";
                }

                currentTimeframeUnit = unit;
                timeframeSuffix.textContent = unit;
                updateTimeframeDisplay();

                // Trigger recalculation
                if (
                    window.calculator &&
                    typeof window.calculator.calculate === "function"
                ) {
                    window.calculator.calculate();
                }
            }

            function handleTimeframeChange() {
                updateTimeframeDisplay();

                // Trigger recalculation
                if (
                    window.calculator &&
                    typeof window.calculator.calculate === "function"
                ) {
                    window.calculator.calculate();
                }
            }

            function getTimeframeInMonths() {
                const value =
                    parseFloat(document.getElementById("timeframe").value) ||
                    30;
                return currentTimeframeUnit === "years"
                    ? Math.round(value * 12)
                    : value;
            }

            // Update years display when months change
            document.addEventListener("DOMContentLoaded", function () {
                const timeframeInput = document.getElementById("timeframe");
                if (timeframeInput) {
                    timeframeInput.addEventListener(
                        "input",
                        updateTimeframeDisplay,
                    );
                    updateTimeframeDisplay(); // Initial call
                }
            });
        </script>
    </body>
</html>
